package com.example.xposed_demo;

import com.alibaba.fastjson.JSON;
import com.virjar.sekiro.api.SekiroClient;
import com.virjar.sekiro.api.SekiroRequest;
import com.virjar.sekiro.api.SekiroRequestHandler;
import com.virjar.sekiro.api.SekiroResponse;

import java.util.Arrays;
import java.util.Objects;
import java.util.UUID;

import cn.hutool.core.codec.Base64;
import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XC_MethodHook;
import de.robv.android.xposed.XposedBridge;
import de.robv.android.xposed.XposedHelpers;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;


public class HookDewuSekiro implements IXposedHookLoadPackage {

    /*
    * 使用sekiro调用so文件， 共有两个方法，分别是加密和解密
    * */

    private String hookPackageName = "com.shizhuang.duapp";
    private String host = "52.82.6.197";
    private String groupName = "dewu";
    private String actionName = "callc";
    private String clientId = UUID.randomUUID().toString();
    private Object encryptClassObj = null;
    private String Tag = "dewu log: ";

    @Override
    public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {
        /*
        hook逻辑开始
         */

        if (lpparam.packageName.equals(hookPackageName)) {
            XposedBridge.hookAllMethods(XposedHelpers.findClass("com.shizhuang.dusanwa.main.SwSdk", lpparam.classLoader), "heracles", new XC_MethodHook() {
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    XposedBridge.log("hook到了得物 heracles");
                    super.afterHookedMethod(param);
                    XposedBridge.log("param.thisObject != null"+param.thisObject);

                    // Class clazz = lpparam.classLoader.loadClass("com.shizhuang.dusanwa.main.SwSdk");
                    if (XposedHelpers.findClass("com.shizhuang.dusanwa.main.SwSdk", lpparam.classLoader) != null) {
                        final Class classz = XposedHelpers.findClass("com.shizhuang.dusanwa.main.SwSdk", lpparam.classLoader);
                        // encryptClassObj = XposedHelpers.findClass("com.shizhuang.dusanwa.main.SwSdk", lpparam.classLoader);
                        /*解决函数调用问题*/
                        //连接服务端并且注册处理的handler
                        XposedBridge.log("=========== sekiro服务启动 ===========");
                        try {
                            final SekiroClient sekiroClient = SekiroClient.start(host, clientId, groupName);
                            sekiroClient.registerHandler("heracles", new SekiroRequestHandler() {
                                @Override
                                public void handleRequest(SekiroRequest sekiroRequest, SekiroResponse sekiroResponse) {
                                    String arg1_str = sekiroRequest.getString("arg1");
                                    byte[] arg1 = Base64.decode(arg1_str);
//                                    arg1 =new byte[] {-42,-46,22,-116,19,35,-109,-119,-45,105,-74,-93,113,41,97,-93,-5,95,-58,-25,-8,4,-32,63,-33,-80,-61,-34,23,18,-26,114,31,45,-2,-31,-100,113,-112,-84,-70,44,65,-65,6,35,54,-3,64,37,-106,39,-71,100,-75,-80,126,73,98,-53,-95,-98,-93,38,38,114,20,-107,-40,-49,-35,83,-68,-55,96,-84,-47,68,57,44,-106,-64,-86,-90,-61,-27,118,-99,-46,79,125,61,38,29,80,-113,-62,-118,-2,-89,76,-115,-120,103,52,-52,-91,-32,-23,-105,18,-119,80,-21,109,-114,-74,6,101,-73,-2,33,-30,42,38,110,120,-40,74,-85,3,27,-124,-23,-85,-18,-33,-90,-119,43,-10,124,-58,-33,7,125,-8,1,26,38,-60,-67,-109,45,124,61,14,106,-51,68,-44,-86,-73,50,-96,49,11,73,62,-109,124,-56,88,-112,-127,-24,-52,37,123,58,-10,-20,0,41,-18,-112,101,35,-9,-76,-42,-68,-20,120,115,-22,23,-33,91,-91,-97,69,72,100,-19,44,-87,-12,-122,-91,125,60,-91,32,43,-73,-70,-71,-113,91,-125,-34,-122,94,-62,56,63,124,-69,-116,117,-108,45,-14,20,14,8,71,-19,-57,68,79,-115,37,111,20,-65,61,-91,-84,-99,29,-8,-59,-102,74,-14,125,-16,-17,-125,-66,50,119,105,-95,-109,-88,9,67,57,124,-83,-102,-31,82,0,-107,-95,66,110,-27,56,-75,122,-7,83,91,-107,89,-32,-91,-90,-18,-49,-73,-106,34,69,116,13,122,32,-75,55,-4,17,-55,-79,-88,-61,-44,-89,-57,24,-94,-19,-56,76,44,43,-103,-34,-26,-5,-76,107,38,86,97,-41,73,-108,-58,84,123,-118,6,70,87,-117,-125,-72,-97,-121,34,5,-17,-18,-83,125,92,-71,34,63,-5,-126,-53,83,67,-109,61,-3,-67,-88,113,-77,69,-123,105,117,-53,120,57,-121,-20,110,-123,21,32,68,-61,-34,-26,7,125,-36,-79,105,-71,-35,114,-6,-84,14,-47,58,-45,-98,6,75,-49,-89,-59,-50,-51,61,77,72,123,126,4,-6,123,100,64,122,-49,117,-71,34,9,-92,-105,49,-49,-112,-119,-75,117,-88,-112,-3,126,-117,40,1,-65,-106,21,77,-71,16,-77,-35,62,-124,8,-23,-50,21,-75,-86,-106,103,37,-80,-113,41,-5,-54,110,81,-18,-17,-52,-106,-3,-101,112,-128,115,-93,-67,85,35,101,76,54,-81,49,63,19,73,78,66,106,-50,-65,83,-46,89,-48,-126,20,-96,-93,-44,-114,-78,119,-113,72,-33,-91,49,-95,37,-96,127,20,31,-46,22,4,18,27,49,-25,-82,-71,87,124,-99,-1,-74,-90,-62,-6,-43,-107,-102,-74,37,-120,-115,-75,95,111,-83,-72,-114,0,34,-126,83,47,-117,36,25,-107,-86,-89,-55,0,-111,16,-18,-4,-10,-94,90,-3,29,100,-91,0,33,45,23,97,62,50,76,12,48,106,-79,-98,5,-33,92,80,17,110,-55,121,68,5,-101,-94,-44,-84,-37,-80,-114,121,-16,57,-77,-6,-30,93,-102,25,73,-56,107,-107,-5,-125,-44,111,88,96,69,-92,-20,-94,-84,-3,-79,-39,69,-2,61,-35,70,30,122,125,29,68,-75,-68,-35,62,89,29,111,112,-97,-72,41,-89,-35,-125,9,13,-34,88,-71,119,-52,86,-109,71,106,58,-9,69,32,-64,-4,-100,-123,-100,-39,-52,-31,-128,-98,3,91,113,-52,24,116,-84,-39,-78,55,122,-86,-82,49,94,-1,37,-83,-126,36,52,-41,3,-115,-54,-64,-90,-125,-40,-39,-111,-104,111,84,-71,-72,58,19,99,-23,53,112,-82,-118,-120,-87,-5,28,55,105,102,30,39,77,-26,-25,-84,32,-77,-102,22,-46,-50,-55,94,1,-112,73,-45,66,-115,77,-49,-118,-66,-3,-53,119,25,-64,34,110,96,110,-62,-30,-71,-39,-28,6,-127,-91,31,-28,78,0,-9,-15,120,-69,-37,78,-22,-91,99,123,104,59,-25,9,-67,-80,86,-117,-82,18,-34,-115,-25,-107,66,115,-44,87,20,-64,-30,96,127,7,-103,-41,-20,94,38,53,108,76,-75,-98,-71,-37,96,-63,87,80,120,44,-61,90,-123,38,-53,109,109,110,83,-58,27,33,-43,32,18,-124,-125,-50,61,-55,-125,127,4,-116,74,20,-64,82,-125,-60,-121,-70,-27,124,89,-85,-14,20,51,-33,-58,37,117,-96,-109,-13,26,76,-37,-111,111,-95,-12,41,-40,-85,-18,127,123,-11,37,4,29,127,-5,-78,58,-99,33,31,81,96,14,46,-4,-72,66,5,52,49,-19,97,-56,13,-47,-103,-123,-114,-61,-117,76,26,-16,20,34,-94,69,11,88,-125,-116,-85,26,52,-3,-124,-31,5,-101,99,-84,3,-79,126,92,56,-111,-31,-91,-62,-79,26,-43,30,45,-44,82,-115,-34,105,-41,-58,92,15,80,61,32,-72,-105,22,-114,56,115,90,-102,86,116,-59,76,-114,-31,-115,-19,86,-44,91,-95,123,19,12,-36,-70,52,-84,-38,78,74,-103,-24,111,75,-17,74,45,53,-115,5,-62,39,-3,107,110,81,-59,8,-12,28,-84,-68,1,-127,57,-55,-6,54,-19,114,67,-33,82,-64,99,46,-92,70,-44,-38,1,-117,-84,-98,16,37,32,-103,-93,-43,-94,-87,-103,-16,-55,-47,-96,-100,123,-51,-83,-68,-45,-68,53,105,-40,12,-125,-113,-113,117,-52,20,-86,125,74,-88,-10,-124,-92,-40,29,-12,110,78,-8,51,-2,-9,99,48,-63,-64,83,-30,18,-93,60,-31,-95,67,117,76,-1,-120,118,56,-20,-22,25,38,59,6,96,-20,-110,96,-59,-66,93,25,114,18,-118,-75,-24,3,-4,-54,-47,93,8,92,43,33,-3,98,-78,73,-124,38,112,77,48,-59,21,-56,99,-13,-73,-116,-125,20,9,21,-98,27,-126,-90,-81,103,-84,32,109,-95,-50,-81,104,-40,-88,-36,-104,-20,32,-18,-1,14,97,-16,-89,-24,-46,-118,57,-24,-68,85,29,-71,-100,10,-81,71,-34,36,120,80,-5,57,54,-126,-17,-28,12,-100,37,45,90,-46,45,59,60,77,12,84,-89,-55,-97,106,-17,118,-116,7,-65,-113,-125,120,-14,-102,-18,-42,71,100,70,-37,-118,117,-100,-115,-83,-25,-44,-62,-114,-125,13,52,-30,-26,-86,-127,122,92,22,-109,55,-104,10,21,51,83,-99,2,-109,-2,47,-42,-11,-46,-106,-43,97,-31,-128,-40,102,-52,-10,96,52,-57,-126,-22,97,64,125,95,-70,100,8,12,-8,16,82,107,50,-74,-82,-123,41,-127,35,-68,25,20,3,63,-8,-47,-50,-3,-40,-67,-81,10,64,-95,86,113,-70,-64,114,43,64,9,-15,-64,1,82,-14,111,36,-38,23,10,-12,88,37,63,-41,-79,115,-123,125,112,31,86,88,-34,61,-37,27,-119,-22,-51,-4,-30,-80,-39,41,-90,37,-2,-112,60,-32,-105,59,-19,-46,-13,19,68,63,-30,31,-67,-42,109,-124,35,-121,-71,-55,95,-75,-106,-66,-9,-53,-79,-61,-13,41,41,-40,-97,-62,13,-40,0,-95,122,98,125,88,104,-68,122,107,-4,33,-7,-1,75,-69,-75,89,-43,56,27,-61,41,51,96,98,-82,-17,-100,122,46,-4,-35,1,86,-37,-50,-44,0,8,115,-28,72,-80,-20,6,-51,-115,27,106,57,-29,72,-105,29,84,31,-127,53,83,-56,-88,-85,-89,-21,-24,46,98,18,-20,-7,-92,-108,-72,-70,-55,108,63,-84,7,-53,-24,-112,39,-124,-27,36,13,53,-90,-84,66,15,-37,78,15,-89,50,-110,105,61,29,-91,-82,-46,-107,82,31,-54,60,-51,79,108,111,100,-64,117,-70,-61,57,100,-11,-87,-60,112,116,-121,-117,-126,-8,66,-1,-5,72,-19,8,-105,-52,-105,41,-49,-85,-103,-16,17,3,-90,-57,-18,64,-9,93,-64,-99,-111,-9,112,-15,-21,-51,56,-21,51,-10,113,19,-33,-93,9,-30,30,-65,-119,30,-113,-36,28,53,114,-6,127,-126,56,6,-59,-4,-9,-107,-40,40,0,13,64,3,-32,-43,61,-117,24,75,30,-43,60,-58,-39,-42,-88,60,83,94,-97,115,-26,-103,2,-123,-36,26,35,-80,-121,51,-93,-69,-92,-42,-108,102,123,-48,119,-97,89,25,35,-64,-88,-63,-28,-68,-36,-120,127,112,-40,27,89,39,-94,22,75,116,76,100,-26,97,59,-37,-60,-3,10,-103,2,32,120,-108,-38,69,-84,-47,121,16,-40,52,-84,-23,-101,72,23,-57,32,69,-92,98,2,-104,13,-97,-27,-101,-64,-111,6,-11,39,95,-101,-85,68,118,-61,-2,71,-83,-18,11,114,-83,60,-6,-32,-38,-43,114,42,62,102,-10,-89,-127,103,-94,-74,121,-83,-86,28,38,-103,6,18,100,-6,86,61,27,87,122,-71,-127,-64,-58,11,114,41,-37,-63,-19,9,-48,-37,-70,45,89,31,95,-13,12,-93,-83,34,-98,-118,-106,-121,-107,115,-57,-75,-126,-57,84,-100,85,51,54,-8,-25,-86,107,-30,86,-22,-56,46,65,-50,-98,-76,-45,40,-112,-87,59,46,-71,101,-92,34,-7,-41,-108,-89,-53,85,-23,-16,-36,-7,97,113,76,-118,-93,-90,-93,60,-96,100,50,-111,-4,-69,45,81,7,114,49,-17,-48,45,104,-127,58,-76,-22,-19,36,-15,-78,-61,-127,-41,75,-31,-66,-105,99,-74,49,-105,34,-76,79,-54,-6,101,101,-17,63,100,28,-80,118,43,104,-108,-33,78,118,-35,-9,40,-68,85,5,56,-14,-89,84,18,55,0,-35,-121,-102,3,-55,-13,97,-100,40,-32,26,-14,70,111,68,-5,103,-118,-16,42,-57,126,-128,77,73,7,-108,88,-47,77,91,50,-95,-34,111,55,-72,40,-88,75,-50,-19,17,15,106,-15,89,60,-10,-94,96,-81,-122,-7,-66,-111,-96,-38,-37,-54,-83,-31,76,-112,69,-86,-21,-99,-124,-27,86,102,100,58,113,105,-12,-63,48,66,-101,-127,0,28,-47,117,6,-13,-126,-83,109,-61,5,-79,61,53,16,-92,-96,-4,10,-71,126,-114,25,31,28,-87,92,-124,103,37,-67,-110,126,-21,62,56,26,-118,-40,54,-92,71,9,-20,-81,-75,-32,108,20,-88,72,-112,-21,93,-66,-36,-120,-60,42,102,-53,106,10,-27,56,-6,38,49,81,107,-47,94,-17,-63,-81,75,54,126,-46,-54,95,3,34,-93,17,-1,33,51,95,16,-56,124,-91,15,19,69,64,42,-57,123,60,-111,40,61,-96,105,77,119,61,124,-78,-55,45,8,-21,99,91,-92,71,-50,-26,121,-102,-95,40,43,115,10,108,127,-77,28,-6,115,75,31,125,50,94,-34,25,37,79,-27,66,-101,10,57,60,-7,96,-68,-25,-4,70,78,-109,14,127,-63,-16,46,23,-6,-43,54,52,-23,-80,-36,-99,-26,-90,-70,86,14,-44,-75,91,65,-92,-70,95,-67,74,100,-41,-95,-3,-124,-111,-98,-60,85,-99,-103,-5,-3,-92,44,-13,68,31,-40,-114,-48,44,107,55,126,-85,-52,25,-80,-94,-1,86,70,3,-35,-92,45,126,2,-61,104,59,-108,101,108,103,-8,104,-80,52,58,-95,71,-103,12,116,40,80,-101,100,-31,85,-97,-96,20,69,-37,78,-96,-44,-41,15,-92,35,4,62,4,-66,-19,-70,28,-120,-119,-73,-52,115,88,68,-79,-4,-50,18,-68,-110,-54,119,-74,-12,-10,-103,104,6,-70,-54,-110,14,-71,-33,57,-4,20,87,86,-104,64,-126,-41,-108,126,41,-87,-26,19,-16,45,37,-127,-95,-59,-43,-114,-69,121,70,92,76,57,105,-28,15,125,-85,-93,-26,-27,-105,-112,33,113,120,57,-82,18,75,101,-69,43,-114,25,-52,-27,-24,107,68,-50,94,11,-79,52,119,-46,-34,13,-31,7,106,-43,-64,-6,-75,113,-73,71,-58,-73,95,81,119,-38,-84,80,-20,-56,13,-60,-81,-120,-98,64,76,31,103,105,-72,56,95,100,42,-33,21,-66,85,-113,-99,-112,100,-58,-80,-101,20,47,-14,-50,-41,-45,-117,107,-57,67,-128,-70,-26,70,-35,126,-92,22,-73,-43,72,-112,6,2,63,77,-8,59,-55,-59,-52,46,-88,51,125,57,-23,88,106,-124,-106,-102,11,-79,98,9,-7,75,-40,-84,84,-69,-123,-8,-11,-125,-57,45,-60,-5,73,-26,-31,86,-53,23,-49,-73,87,51,28,92,51,57,-79,-126,-42,-86,59,99,-23,113,103,-71,-48,-13,-111,-58,-37,-113,-67,-61,-69,98,80,-110,-94,69,16,62,-50,117,-63,3,47,-45,-57,-122,117,-34,58,23,-76,41,8,-21,-71,5,125,39,-121,54,21,113,68,115,108,106,65,63,24,-113,10,-56,68,-98,-1,-30,-49,121,9,34,72,-62,97,40,-73,40,11,25,-101,125,6,-12,77,-125,39,-3,-116,87,-4,-88,0,69,-61,125,-7,-80,2,-77,70,-128,-33,90,-83,10,-9,-37,-90,-74,-88,-73,116,76,-43,-55,-22,126,-49,87,70,-93,122,3,-58,36,-29,62,60,-32,-73,28,86,2,53,-125,-17,63,80,50,-21,50,-116,124,-39,108,8,61,-83,-53,-71,-117,34,-91,-40,-81,-22,-31,57,48,-89,-85,62,81,54,12,117,-111,-96,74,-72,-104,-60,47,60,-121,30,-75,-72,30,111,4,-23,-61,-66,-47,-116,122,97,110,-111,19,75,69,-26,90,-14,97,102,91,-5,57,-25,-9,86,-95,-127,-31,35,-33,-107,104,-46,-106,99,-49,-85,-100,-112,-8,-105,60,-43,82,-93,95,-110,107,-43,37,102,-34,-2,17,52,122,44,-42,-37,24,15,63,66,29,-83,-72,83,30,-121,54,20,82,21,41,-23,32,-15,-24,81,29,30,-39,22,117,26,-121,-74,-84,44,112,-95,-74,-29,46,33,17,-114,18,92,67,-32,6,-52,-38,33,65,73,52,101,42,56,-15,-90,8,-53,66,-83,-115,67,1,49,-125,-39,61,-78,60,-115,78,-96,-128,74,27,72,-59,53,17,-16,83,94,17,-33,-100,-2,49,-111,110,78,59,-83,-69,-120,-29,87,-58,-65,48,-76,-120,-126,-83,24,4,87,77,-82,28,28,38,72,-105,117,-4,47,-13,22,-97,97,-39,101,-113,-9,54,-37,-83,-75,-22,12,85,48,-20,-64,-69,-110,-9,9,88,12,85,73,77,-50,-96,-49,-55,11,-115,-6,-43,12,97,-66,83,116,122,113,96,59,122,-6,90,-110,14,-25,-57,-37,83,2,1,-17,-94,-48,-109,34,-117,-82,-54,-48,14,-4,-91,4,84,-8,-99,-25,51,3,-29,-3,78,-42,-26,-91,-78,-44,-55,72,-20,-13,127,119,72,66,103,-49,-117,-55,-65,8,-122,-31,125,29,-16,104,109,34,-125,-10,-29,27,65,78,79,63,-117,-33,-99,21,-70,68,75,73,-23,-20,71,27,9,-64,90,-117,-123,15,-34,-76,3,84,121,-42,-63,26,-96,15,-98,127,-98,-62,45,-8,-44,-114,45,79,69,-106,84,19,-40,-73,70,-80,-100,88,30,50,78,67,1,-38,82,5,106,87,69,105,-60,-13,49,-75,65,-84,101,-85,65,-109,-77,19,-11,-85,-88,19,9,46,-8,43,107,58,50,2,33,-120,-12,14,57,-94,-127,-10,51,22,89,-34,-9,85,48,10,-8,87,-27,23,66,-42,-29,-97,20,-37,-102,38,-62,-86,-79,109,16,34,-72,110,-83,104,109,127,-22,113,-28,-112,82,120,-112,51,-33,105,29,-123,80,-48,-79,49,-12,-52,59,-64,-75,7,78,-102,53,-19,52,-82,47,30,13,72,29,-105,-126,-42,-118,-1,-98,119,0,43,66,-6,110,120,-125,-32,64,-48,64,121,98,26,111,-83,-61,-16,-49,70,59,103,-38,-17,-112,-71,-34,23,-38,91,-99,6,42,5,-16,16,44,95,74,21,-55,62,56,92,-125,30,-106,-53,107,84,1,-5,93,-28,-62,-62,37,112,-50,-24,-47,24,90,72,-28,117,48,85,-99,-120,122,6,-44,-73,104,37,90,41,3,50,-37,-95,59,-23,-101,81,-17,22,-70,-49,58,8,28,-8,-86,69,11,-31,-24,115,-102,-4,85,-60,-51,-114,49,-30,-64,-43,80,105,-119,15,-31,-25,18,111,11,109,27,67,-25,34,3,122,-5,72,54,-118,123,99,-108,85,-15,112,-99,-41,6,61,-115,13,-83,-119,115,-77,75,68,61,61,-43,50,-42,-104,-52,123,-48,16,53,-45,108,-39,65,84,-87,72,-117,19,-120,-85,-107,-109,-80,55,26,-17,23,-108,24,-33,15,14,-59,28,70,-68,113,88,80,-113,-75,102,106,66,-90,12,-117,114,-21,124,-6,40,42,20,-74,-58,65,-101,66,-74,-106,-100,19,-106,-39,126,10,30,-34,-13,26,15,-40,-124,-52,-42,127,-26,37,-25,-14,70,33,-66,-107,-45,-38,24,0,126,1,117,-7,27,-30,-91,-10,33,-120,99,43,20,3,-44,-89,-48,15,117,93,121,-102,75,-31,88,67,68,19,106,41,-102,18,-45,-127,122,71,-121,-28,-25,-42,-67,-123,27,2,75,-22,-64,113,36,64,46,47,69,-84,-121,81,79,-104,54,-2,100,-34,113,71,-106,-91,41,-67,-37,76,-15,-37,120,-92,-30,92,95,95,-16,-25,89,92,110,-96,108,-19,-1,-1,23,103,-126,-44,-61,-107,-4,13,57,-48,-81,-93,8,67,-123,99,-83,83,56,108,110,-98,1,6,4,-58,21,-101,77,49,73,-84,61,-40,-69,-29,-118,126,59,-18,-88,-10,63,81,74,-84,-9,-69,-18,-124,-113,95,53,75,44,-49,79,-28,-119,-50,63,127,122,118,-1,-63,50,-61,5,49,32,47,-95,-52,-92,57,103,-13,-3,-39,-29,-3,-50,17,113,63,24,37,-83,-91,-39,-93,-69,-96,120,107,-2,66,-116,-111,60,-64,-117,-80,-66,-87,-38,-67,96,4,-35,51,-42,-51,75,9,-115,-20,-53,-72,-108,-85,-25,92,-79,33,-63,6,42,-69,-125,17,-86,-23,67,-128,-32,-69,-24,-13,15,-101,-48,24,32,56,54,-113,36,-78,54,-125,127,89,-5,-33,-105,-59,72,-105,-123,51,-117,84,-17,79,-65,10,-46,-100,67,-59,21,-25,-77,98,115,-14,86,50,32,28,47,-107,95,-127,80,-74,-81,3,-21,-19,-41,79,119,29,-75,30,52,60,-51,27,96,71,-120,41,93,-101,-100,-9,0,31,-74,31,26,-72,0,-63,-25,-51,51,39,120,-86,2,-32,-81,68,118,111,-41,-32,-8,93,-40,126,72,69,100,-64,-2,14,23,-12,9,37,88,92,104,-65,-43,21,-1,66,-25,54,82,94,42,43,-70,-1,-56,40,-16,-103,54,55,-84,-122,45,-47,-93,-70,94,94,-79,-95,8,-66,104,16,58,-43,-81,99,48,4,-82,-17,52,81,125,-9,-6,-38,9,54,12,-127,113,-7,-8,6,-46,50,8,-13,-48,70,72,-78,64,53,121,-18,-124,104,33,-44,10,-118,-99,14,-16,-81,67,-112,-96,55,-34,39,39,33,80,111,-18,-111,-117,-105,110,-26,64,-52,69,126,-27,36,-70,-86,30,122,47,-80,-108,-63,2,-53,5,86,-2,-117,11,123,-122,4,-98,-68,113,-29,15,-8,-60,56,110,8,-109,78,108,49,39,2,-117,-107,61,-100,-126,-63,-50,-121,-122,58,2,-100,60,-125,13,-9,-19,64,-126,47,106,55,26,119,121,29,116,8,-46,18,-82,-83,34,25,79,1,117,-37,15,-120,-111,62,118,-16,-123,11,9,26,-95,66,72,98,41,-76,20,123,30,68,-105,-104,-111,29,-5,0,27,-16,-25,-7,116,34,106,10,-86,-53,-118,-14,73,-95,-56,-124,-8,-75,-83,33,95,37,117,20,58,47,78,-21,95,37,117,20,58,47,78,-21,95,37,117,20,58,47,78,-21,39,123,-88,38,39,-35,85,19,88,-91,-35,-120,-127,9,78,112,87,83,48,-37,76,79,19,87,-16,39,-94,58,-103,7,34,23,-44,-75,-24,45,-123,118,1,91,100,114,89,6,-127,-68,-67,91,-83,-65,14,56,115,-29,-94,-128,125,37,29,88,5,-85,51,-63,-83,-73,87,51,103,-21,112,72,-41,62,-35,124,-80,-74,-75,-112,-56,-82,-1,95,62,58,90,-36,-69,86,-76,-83,-44,33,93,-27,-80,56,-64,51,-74,120,31,-18,-40,-99,58,-112,115,70,-24,-102,32,-14,113,-103,-82,-101,-24,-17,-124,-79,-69,-84,-68,17,-60,99,84,-109,-123,33,-89,-84,-54,-60,-120,-77,-72,-83,-56,61,37,-126,86,32,-30,78,63,113,57,58,89,-115,-38,45,117,85,-85,-105,21,77,-46,-105,72,45,-27,77,0,-41,-27,-99,55,15,14,-80,41,-30,-79,-13,12,93,-62,-42,-3,-63,76,19,-16,62,16,-103,87,106,59,-28,-117,-128,-96,122,32,-31,-78,-32,36,-92,-101,-100,-128,-34,48,-80,90,-128,-33,-26,37,54,2,2,-53,102,18,54,123,-42,77,110,83,-39,-68,-103,-40,122,114,69,5,9,66,96,79,69,90,86,-102,76,-18,114,115,0,-82,51,-37,-65,-66,-63,-39,-86,21,85,66,12,-48,-39,114,-62,12,95,27,100,12,71,-59,-120,-22,85,63,-75,-26,90,92,69,-71,-13,-44,6,-65,-111,103,-9,91,-92,-97,-99,19,110,-113,-3,124,-61,-55,22,47,-122,-8,75,106,89,79,113,-1,-52,2,27,90,-111,-98,-104,60,25,97,-84,-112,-110,-69,-125,-20,35,-43,116,-101,-13,-11,25,-80,-55,6,39,4,-89,58,113,-65,50,-64,-111,10,-68,23,10,-111,-34,-62,114,-30,22,6,-48,-6,-22,5,23,-56,67,45,-122,98,21,-44,-52,-39,104,-124,-26,94,-102,-29,-57,0,-38,94,29,-21,6,46,-72,110,-28,119,61,-16,-19,-38,-88,75,-46,3,13,-49,-56,45,53,93,45,-31,-92,85,104,116,80,-113,-64,35,-75,108,39,48,-82,45,-100,71,-11,80,24,125,-13,-31,56,-115,41,87,82,9,24,-75,60,89,88,12,-105,9,24,-75,60,89,88,12,-105,69,53,73,55,34,-54,28,-112,55,-50,82,11,-104,20,-30,50,-10,-70,-66,-77,-98,98,-90,87,-2,112,-44,-24,107,31,20,-18,-92,-26,41,56,-128,-42,81,-85,86,-58,1,-99,-43,-19,-52,-21,118,92,102,-33,60,-82,83,121,-100,-96,2,44,51,28,58,76,-81,91,-79,-33,-97,94,31,25,0,-117,25,49,9,-40,-101,-46,-98,-24,4,97,43,-89,-68,-80,103,72,-17,-52,51,52,89,89,47,111,59,-14,-93,7,-91,18,107,-25,-12,108,121,-10,-115,-19,-93,91,-32,-23,-35,-53,-113,6,127,-126,-80,-91,25,108,28,-93,83,33,49,-119,-79,79,22,13,16,78,-78,46,-11,-106,26,35,3,-103,-104,-76,-53,-26,-63,-64,103,-62,38,77,-61,92,53,85,26,-96,119,125,123,-53,-97,-2,8,48,79,-108,27,38,86,26,-120,24,-99,95,12,-9,-104,-50,-14,-33,-63,-17,78,52,124,-116,104,-15,25,-48,58,64,-2,-55,92,-38,27,86,-98,-46,46,-12,-110,71,-95,-117,-64,86,7,-93,-81,50,8,57,-105,92,-66,-124,60,-60,-104,-6,64,-12,-13,110,-1,125,-100,9,23,-26,-73,25,-59,96,-13,55,69,-49,78,-17,52,13,109,-127,-31,-73,-118,45,-100,32,-56,-45,-39,-93,-9,-99,-112,-32,103,33,-70,104,11,-95,18,5,99,68,-36,-118,-19,113,-99,72,-119,-79,76,-70,69,53,44,3,-71,57,1,38,-107,56,40,59,-80,-126,-38,-18,-39,-27,57,-96,-65,121,81,93,-67,-17,-58,-53,72,61,-61,-7,-109,4,19,-42,-74,117,-76,-70,78,-106,-31,44,-118,27,-23,79,-46,98,91,-76,-60,45,-66,39,-62,51,37,117,-79,42,110,13,28,-69,-41,30,125,79,-29,53,85,42,79,-13,-116,-85,99,53,94,21,79,-83,-71,26,-15,-122,45,84,-3,98,-27,-84,-99,31,-59,-25,40,55,-85,-86,94,-115,-31,100,35,63,-12,126,9,-114,-119,-58,-118,102,76,-14,-17,-8,25,18,115,-27,-9,1,51,10,110,-72,-8,85,-79,115,27,89,-37,-93,41,19,22,92,91,-64,-64,110,119,-35,6,-4,-18,-123,105,61,72,109,-59,-27,-128,21,124,-57,-110,117,120,63,-84,-59,-85,-59,46,-57,-8,24,84,-7,-115,-107,-100,-99,76,-73,7,-15,116,-84,-115,18,-116,49,-73,-22,51,-124,-49,125,56,52,-123,-30,-82,-35,-103,26,-15,87,-25,-58,21,83,39,-13,-98,35,-122,88,-89,8,-3,-1,-38,4,19,111,29,-84,-83,-43,-36,-39,113,-92,42,-50,-22,-31,47,-73,-122,-70,120,-119};
                                    int arg2 = sekiroRequest.getInt("arg2");
                                    int arg3 = sekiroRequest.getInt("arg3");
                                    XposedBridge.log("heracles arg1: " + arg1 + ", arg2: " + arg2 + ", arg3: " + arg3);
                                    Object res_origin = XposedHelpers.callStaticMethod(classz, "heracles", arg1, arg2, arg3);
                                    String res = new String();
                                    if(res_origin != null){
                                        res = JSON.toJSONString(res_origin);
                                    }
                                    XposedBridge.log(Tag + "heracles arg1: " + arg1_str + arg1 + ", arg2: " + arg2 + ", arg3: " + arg3 + ", result: " + res);
                                    sekiroResponse.success(res);
                                }
                            });
                            final SekiroClient sekiroClient1 = SekiroClient.start(host, clientId, groupName);
                            sekiroClient1.registerHandler("achilles", new SekiroRequestHandler() {
                                @Override
                                public void handleRequest(SekiroRequest sekiroRequest, SekiroResponse sekiroResponse) {
                                    String arg1_str = sekiroRequest.getString("arg1");
                                    byte[] arg1 = arg1_str.getBytes();
                                    byte[] res_origin = (byte[]) XposedHelpers.callStaticMethod(classz, "achilles", arg1);
                                    String res = Base64.encodeUrlSafe(res_origin);
//                                    String res = Base64.encode(res_origin);
                                    XposedBridge.log(Tag + "achilles arg1: " + arg1_str);
                                    XposedBridge.log(Tag + "achilles result: " + res);
                                    sekiroResponse.success(res);
                                }
                            });
                        } catch (Exception e) {
                            XposedBridge.log(Objects.requireNonNull(e.getMessage()));
                        }

                        XposedBridge.log("=========== sekiro服务启动成功 ===========");
                    }
                    Object[] args = param.args;
                    XposedBridge.log("args is  ");
                    XposedBridge.log(Arrays.toString((byte[]) args[0]));
                    XposedBridge.log(JSON.toJSONString(args[1]));
                    XposedBridge.log(JSON.toJSONString(args[2]));
                    Object result = param.getResult();
                    XposedBridge.log("result is  "+ JSON.toJSONString(result));
                }
            });
            XposedBridge.hookAllMethods(XposedHelpers.findClass("com.shizhuang.dusanwa.main.SwSdk", lpparam.classLoader), "achilles", new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    XposedBridge.log("hook到了得物 achilles");
                    Object[] args = param.args;
                    XposedBridge.log("achilles args is  " + args[0]);
                    Object result = param.getResult();
                    XposedBridge.log("achilles args is  " + new String((byte[]) args[0]));
                    XposedBridge.log("achilles result is  " + JSON.toJSONString(result));
                    super.beforeHookedMethod(param);
                }
            });
        }
    }
    /*
    hook逻辑结束
    */
}
